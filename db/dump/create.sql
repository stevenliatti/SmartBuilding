-- MySQL Script generated by MySQL Workbench
-- mar 07 jan 2020 09:27:34 CET
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema iot
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `iot` ;

-- -----------------------------------------------------
-- Schema iot
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `iot` DEFAULT CHARACTER SET utf8 ;
USE `iot` ;

-- -----------------------------------------------------
-- Table `iot`.`Room`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `iot`.`Room` ;

CREATE TABLE IF NOT EXISTS `iot`.`Room` (
  `number` INT NOT NULL,
  `floor` INT NOT NULL,
  PRIMARY KEY (`number`),
  UNIQUE INDEX `number_UNIQUE` (`number` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `iot`.`Beacon`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `iot`.`Beacon` ;

CREATE TABLE IF NOT EXISTS `iot`.`Beacon` (
  `uuid` VARCHAR(255) NOT NULL,
  `major` INT NOT NULL,
  `minor` INT NOT NULL,
  `room_number` INT NOT NULL,
  PRIMARY KEY (`uuid`, `major`, `minor`),
  INDEX `fk_Beacon_Room1_idx` (`room_number` ASC),
  CONSTRAINT `fk_Beacon_Room1`
    FOREIGN KEY (`room_number`)
    REFERENCES `iot`.`Room` (`number`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `iot`.`Device`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `iot`.`Device` ;

CREATE TABLE IF NOT EXISTS `iot`.`Device` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `room_number` INT NOT NULL,
  `kind` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC),
  INDEX `fk_Zwave_node_Room1_idx` (`room_number` ASC),
  CONSTRAINT `fk_Zwave_node_Room1`
    FOREIGN KEY (`room_number`)
    REFERENCES `iot`.`Room` (`number`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `iot`.`Log`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `iot`.`Log` ;

CREATE TABLE IF NOT EXISTS `iot`.`Log` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `timestamp` TIMESTAMP NOT NULL,
  `value` INT NOT NULL,
  `reason` VARCHAR(255) NOT NULL,
  `device_id` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_Knx_log_Device1_idx` (`device_id` ASC),
  CONSTRAINT `fk_Knx_log_Device1`
    FOREIGN KEY (`device_id`)
    REFERENCES `iot`.`Device` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `iot`.`ZwaveNode`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `iot`.`ZwaveNode` ;

CREATE TABLE IF NOT EXISTS `iot`.`ZwaveNode` (
  `node_id` INT NOT NULL,
  `name` VARCHAR(255) NULL,
  `device_id` INT NOT NULL,
  PRIMARY KEY (`node_id`),
  INDEX `fk_ZwaveNode_Device1_idx` (`device_id` ASC),
  CONSTRAINT `fk_ZwaveNode_Device1`
    FOREIGN KEY (`device_id`)
    REFERENCES `iot`.`Device` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `iot`.`KnxNode`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `iot`.`KnxNode` ;

CREATE TABLE IF NOT EXISTS `iot`.`KnxNode` (
  `kind` VARCHAR(255) NOT NULL,
  `bloc` INT NOT NULL,
  `floor` INT NOT NULL,
  `device_id` INT NOT NULL,
  PRIMARY KEY (`kind`, `bloc`, `floor`),
  INDEX `fk_KnxNode_Device1_idx` (`device_id` ASC),
  CONSTRAINT `fk_KnxNode_Device1`
    FOREIGN KEY (`device_id`)
    REFERENCES `iot`.`Device` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;


-- -----------------------------------------------------

INSERT INTO `iot`.`Room` (`number`, `floor`) VALUES (1, 4);
INSERT INTO `iot`.`Room` (`number`, `floor`) VALUES (2, 4);
INSERT INTO `iot`.`Room` (`number`, `floor`) VALUES (10, 4);
INSERT INTO `iot`.`Room` (`number`, `floor`) VALUES (11, 4);

INSERT INTO `iot`.`Beacon` (`uuid`, `major`, `minor`, `room_number`)
  VALUES ('b9407f30-f5f8-466e-aff9-25556b57fe6d', 17644, 12302, 1);
INSERT INTO `iot`.`Beacon` (`uuid`, `major`, `minor`, `room_number`)
  VALUES ('b9407f30-f5f8-466e-aff9-25556b57fe6d', 17644, 31456, 2);
INSERT INTO `iot`.`Beacon` (`uuid`, `major`, `minor`, `room_number`)
  VALUES ('b9407f30-f5f8-466e-aff9-25556b57fe6d', 30874, 43216, 10);
INSERT INTO `iot`.`Beacon` (`uuid`, `major`, `minor`, `room_number`)
  VALUES ('b9407f30-f5f8-466e-aff9-25556b57fe6d', 30874, 10279, 11);

INSERT INTO `iot`.`Device` (`room_number`, `kind`) VALUES (1, "knx");
INSERT INTO `iot`.`Device` (`room_number`, `kind`) VALUES (2, "knx");
INSERT INTO `iot`.`Device` (`room_number`, `kind`) VALUES (10, "knx");
INSERT INTO `iot`.`Device` (`room_number`, `kind`) VALUES (11, "knx");
INSERT INTO `iot`.`Device` (`room_number`, `kind`) VALUES (1, "knx");
INSERT INTO `iot`.`Device` (`room_number`, `kind`) VALUES (2, "knx");
INSERT INTO `iot`.`Device` (`room_number`, `kind`) VALUES (10, "knx");
INSERT INTO `iot`.`Device` (`room_number`, `kind`) VALUES (11, "knx");
INSERT INTO `iot`.`Device` (`room_number`, `kind`) VALUES (1, "zwave");
INSERT INTO `iot`.`Device` (`room_number`, `kind`) VALUES (1, "zwave");

INSERT INTO `iot`.`KnxNode` (`kind`, `bloc`, `floor`, `device_id`) VALUES ("radiator", 1, 4, 1);
INSERT INTO `iot`.`KnxNode` (`kind`, `bloc`, `floor`, `device_id`) VALUES ("radiator", 2, 4, 2);
INSERT INTO `iot`.`KnxNode` (`kind`, `bloc`, `floor`, `device_id`) VALUES ("radiator", 10, 4, 3);
INSERT INTO `iot`.`KnxNode` (`kind`, `bloc`, `floor`, `device_id`) VALUES ("radiator", 11, 4, 4);
INSERT INTO `iot`.`KnxNode` (`kind`, `bloc`, `floor`, `device_id`) VALUES ("blind", 1, 4, 5);
INSERT INTO `iot`.`KnxNode` (`kind`, `bloc`, `floor`, `device_id`) VALUES ("blind", 2, 4, 6);
INSERT INTO `iot`.`KnxNode` (`kind`, `bloc`, `floor`, `device_id`) VALUES ("blind", 10, 4, 7);
INSERT INTO `iot`.`KnxNode` (`kind`, `bloc`, `floor`, `device_id`) VALUES ("blind", 11, 4, 8);

INSERT INTO `iot`.`ZwaveNode` (`node_id`, `name`, `device_id`) VALUES (2, "Multisensor 6", 9);
INSERT INTO `iot`.`ZwaveNode` (`node_id`, `name`, `device_id`) VALUES (3, "ZE27", 10);

INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 142, "read_percentage_blinds", 5);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 143, "read_percentage_blinds", 5);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 144, "read_percentage_blinds", 5);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 145, "read_percentage_blinds", 5);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 113, "read_percentage_blinds", 6);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 112, "read_percentage_blinds", 6);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 111, "read_percentage_blinds", 6);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 110, "read_percentage_blinds", 6);

INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 42, "read_percentage_blinds", 7);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 43, "read_percentage_blinds", 7);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 44, "read_percentage_blinds", 7);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 45, "read_percentage_blinds", 7);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 13, "read_percentage_blinds", 8);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 12, "read_percentage_blinds", 8);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 11, "read_percentage_blinds", 8);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 10, "read_percentage_blinds", 8);

INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 20, "temperature", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 21, "temperature", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 22, "temperature", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 23, "temperature", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 30, "relative humidity", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 31, "relative humidity", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 33, "relative humidity", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 34, "relative humidity", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 40, "luminance", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 41, "luminance", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 43, "luminance", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 44, "luminance", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 0, "sensor", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 1, "sensor", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 0, "sensor", 9);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 1, "sensor", 9);

INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 0, "get_dimmer_level", 10);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 0, "get_dimmer_level", 10);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 50, "get_dimmer_level", 10);
INSERT INTO `iot`.`Log` (`timestamp`, `value`, `reason`, `device_id`) VALUES (NOW(), 50, "get_dimmer_level", 10);
